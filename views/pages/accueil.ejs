<!DOCTYPE html>
<html>
<head>
    <%- include('../partials/head') %>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="container">
    <header>
        <%- include('../partials/header') %>
    </header>

    <main>
        <div class="jumbotron">
            <h1>Accueil</h1>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Date de creation</th>
                        <th>Nom</th>
                        <th>Prix</th>
                    </tr>
                </thead>
                <tbody id="itemTableBody">
                    <% if (items && items.length) { %>
                        <% items.forEach(item => { %>
                            <tr>
                                <td><%= item.id %></td>
                                <td><%= item.dateCreation %></td>
                                <td><%= item.nom %></td>
                                <td><%= item.prix.toFixed(2) %> $</td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="4">Aucun item disponible.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Formulaires -->
        <div class="jumbotron">
            <h2> Supprimer un élément par ID:</h2>
            <input type="number" id="deleteId" class="form-control" placeholder="ID">
            <button id="deleteIdBtn" class="btn btn-danger">Supprimer</button>

            <h2> Supprimer un élément par nom:</h2>
            <input type="text" id="deleteName" class="form-control" placeholder="Nom">
            <button id="deleteNameBtn" class="btn btn-danger">Supprimer</button>

            <h2>Ajouter un item</h2>
            <input type="text" id="addName" class="form-control" placeholder="Nom">
            <input type="number" id="addPrice" class="form-control" step="0.01" placeholder="Prix">
            <button id="addBtn" class="btn btn-primary">Ajouter</button>
        </div>
    </main>

    <footer>
        <%- include('../partials/footer') %>
    </footer>

    <script>
        const socket = io();

        // Mise à jour dynamique du tableau
        socket.on('updateItems', function(items) {
            const $tbody = $("#itemTableBody");
            $tbody.empty();
            if(items.length === 0){
                $tbody.append('<tr><td colspan="4">Aucun item disponible.</td></tr>');
            } else {
                $.each(items, function(i, item){
                    $tbody.append(`
                        <tr>
                            <td>${item.id}</td>
                            <td>${item.dateCreation}</td>
                            <td>${item.nom}</td>
                            <td>${item.prix.toFixed(2)} $</td>
                        </tr>
                    `);
                });
            }
        });

        // Ajout d'un item
        $("#addBtn").click(function(){
            const nom = $("#addName").val();
            const prix = parseFloat($("#addPrice").val());
            $.post("/add", { nom, prix });
            $("#addName").val(""); $("#addPrice").val("");
        });

        // Supprimer par ID
        $("#deleteIdBtn").click(function(){
            const id = parseInt($("#deleteId").val());
            $.post("/deleteById", { id });
            $("#deleteId").val("");
        });

        // Supprimer par nom
        $("#deleteNameBtn").click(function(){
            const nom = $("#deleteName").val();
            $.post("/deleteByName", { nom });
            $("#deleteName").val("");
        });
    </script>
</body>
</html>
